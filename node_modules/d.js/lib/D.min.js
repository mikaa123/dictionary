/* (c) Jonathan Gotti - licence: https://github.com/malko/d.js/LICENCE.txt @version 0.5.1*/
!function(a){"use strict";function b(a){d(function(){throw a})}function c(a,b){var c=h(a);if(1===c.length&&f(c[0])){if(!c[0].length)return l.fulfilled([]);c=c[0]}var d=[],e=l(),g=c.length;if(g)for(var i=(function(a){c[a]=l.promisify(c[a]),c[a].then(function(f){a in d||(d[a]=b?c[a]:f,--g||e.resolve(d))},function(f){a in d||(b?(d[a]=b?c[a]:v,--g||e.resolve(d)):e.reject(f))})}),j=0,k=g;k>j;j++)i(j);else e.resolve(d);return e.promise}var d,e=function(a){return a instanceof Function},f=function(a){return a instanceof Array},g=function(b){return b===!1||b===a||null===b},h=function(a,b){return[].slice.call(a,b)},i="undefined";if(typeof process!==i&&process.nextTick)d=process.nextTick;else if(typeof MessageChannel!==i){var j=new MessageChannel,k=[];j.port1.onmessage=function(){k.length&&k.shift()()},d=function(a){k.push(a),j.port2.postMessage(0)}}else d=function(a){setTimeout(a,0)};var l=function(c){function h(){if(0!==n){var a,b=o,c=0,d=b.length,e=~n?0:1;for(o=[];d>c;c++)(a=b[c][e])&&a.call(null,k)}}function i(a){return n?this:a&&e(a.then)?(a.then(i,j),this):(m(function(){k=a,n=1,h()}),this)}function j(a){return 0===n&&m(function(){try{throw a}catch(b){k=b}n=-1,h()}),this}var k,m=(a!==c?c:l.alwaysAsync)?d:function(a){a()},n=0,o=[],p=l.onlyFuncs,q={then:function(a,b){var c=l();return o.push([function(b){try{g(a)?c.resolve(b):c.resolve(e(a)?a.call(null,b):p?b:a)}catch(d){c.reject(d)}},function(a){if((g(b)||!e(b)&&p)&&c.reject(a),b)try{c.resolve(e(b)?b.call(null,a):b)}catch(d){c.reject(d)}}]),0!==n&&m(h),c.promise},success:function(b){return this.then(b,a)},error:function(b){return this.then(a,b)},apply:function(b,c){return this.then(function(a){return e(b)?b.apply(null,f(a)?a:[a]):p?a:b},c||a)},ensure:function(a){function b(){a()}return this.then(b,b),this},nodify:function(a){return this.then(function(b){return e(a)?a.apply(null,f(b)?b.splice(0,0,void 0)&&b:[void 0,b]):p?b:a},function(b){return a.call(null,b)})},rethrow:function(c){return this.then(a,c?function(a){throw c(a),a}:b)},isPending:function(){return!(0!==n)},getStatus:function(){return n}};return q.toSource=q.toString=q.valueOf=function(){return k===a?this:k},q.otherwise=q.error,q.spread=q.apply,{promise:q,resolve:i,fulfill:i,reject:j}};l.defer=l,l.nextTick=d,l.alwaysAsync=!0,l.onlyFuncs=!0,l.resolved=l.fulfilled=function(a){return l(!0).resolve(a).promise},l.rejected=function(a){return l(!0).reject(a).promise},l.wait=function(a){var b=l();return setTimeout(b.resolve,a||0),b.promise},l.delay=function(a,b){var c=l();return setTimeout(function(){try{c.resolve(a.apply(null))}catch(b){c.reject(b)}},b||0),c.promise},l.promisify=function(a){return a&&e(a.then)?a:l.resolved(a)},l.all=function(){return c(arguments,!1)},l.resolveAll=function(){return c(arguments,!0)},l.nodeCapsule=function(a,b){return b||(b=a,a=void 0),function(){var c=l(),d=h(arguments);d.push(function(a,b){a?c.reject(a):c.resolve(arguments.length>2?h(arguments,1):b)});try{b.apply(a,d)}catch(e){c.reject(e)}return c.promise}},typeof window!==i&&(window.D=l),typeof module!==i&&module.exports&&(module.exports=l)}();